<!DOCTYPE html>
<html lang-"en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>jquery.mobile.iscrollview.js Demo</title>
   
    <link rel="stylesheet" href="jquery.mobile-1.0.1.min.css"/>
    <link rel="stylesheet" href="../iscroll-pull.css"/>  <!--  Can omit if not using pulldown  -->
    
    <script src="jquery-1.6.4.min.js"></script>
    <script src="jquery.actual.min.js"></script>
    <script src="jquery.mobile-1.0.1.min.js"></script>
    <script src="iscroll-watusi.js"></script>
    <script src="../jquery.mobile.iscrollview.js"></script>
  </head>

  <body>
    <div data-role="page" data-dom-cache="true" class="short-pull-demo-page">

      <div data-role="header" data-position="fixed">
        <h1>SHORT PULL</h1>
      </div>

      <div data-role="content" data-iscroll>
      
        <div class="iscroll-pulldown">
          <span class="iscroll-pull-icon"></span>
          <span class="iscroll-pull-label"></span>
        </div>
    
        <ul data-role="listview">
          <li>Original row 1</li>
          <li>Original row 2</li>
          <li>Original row 3</li>
        </ul>
          
        <div class="iscroll-pullup">
          <span class="iscroll-pull-icon"></span>
          <span 
            data-iscroll-pulled-text="Custom pulled text"
            data-iscroll-loading-text="Custom loading text"
            class="iscroll-pull-label" >Custom reset text</span>
        </div>
                            
      </div>

      <div data-role="footer" data-position="fixed" data-id="my-persistent-footer">
        <div data-role="navbar">
          <ul>
            <li><a href="index.html" data-prefetch data-transition="slide">List</a></li>
            <li><a href="inset.html" data-prefetch data-transition="slide">Inset List</a></li>
            <li><a href="pull.html"  data-prefetch data-transition="slide">Pull</a></li>
            <li><a href="shortpull.html" class="ui-btn-active ui-state-persist" data-transition="slide"> Short Pull</a></li>

          </ul>
        </div>
      </div>
      
  <script>
  (function() {  // Self-invoking function to keep definitions local
    var pullDownGeneratedCount = 0,
        pullUpGeneratedCount = 0,
        listSelector = "div.short-pull-demo-page ul.ui-listview",
        lastItemSelector = listSelector + " > li:last-child";
  
    $(document).delegate("div.short-pull-demo-page", "pageinit", function(event) {
        $(".iscroll-wrapper", this).bind( { 
        "iscroll_onpulldown" : onPullDown,    
        "iscroll_onpullup"   : onPullUp
        });
      });  

    function onPullDown (e, d) {
      // SetTimeout here is simulating some action to typically retrieve data from a remote server.
      // Substitute call to .ajax(), etc. which will have a callback to handle the retrieved data.
      // From that callback (simulated by the function called by setTimeout, insert the data into
      // the scroller, then do any necessary jQuery Mobile refresh (as shown below for listview)
      // and then call refresh() on the iscrollview object as well.
      setTimeout(function() {  
        var i, 
            iscrollview = d.iscrollview,
            $list = $(listSelector);
        for (i=0; i<3; i++) {
          $list.prepend("<li>Pulldown-generated row " + (++pullDownGeneratedCount) + "</li>");
          };
        $list.jqmData("listview").refresh();
        iscrollview.refresh();   
        }, 1500); // Simulate time to retrieve data from some server, etc.
      };

    function onPullUp (e, d) {
      setTimeout(function() {   
        var i, 
            iscrollview = d.iscrollview
            $list = $(listSelector);
        for (i=0; i<3; i++) {
          $list.append("<li>Pullup-generated row " + (++pullUpGeneratedCount) + "</li>");
          };
        $list.jqmData("listview").refresh();     
        iscrollview.refresh(null, function() {    // Scroll is delayed until refresh completed
          iscrollview.scrollToElement(lastItemSelector, 400);        
          }, this); 
        }, 1500); 
      };

    })();  
  </script>      

    </div>
     
  </body>
</html>
